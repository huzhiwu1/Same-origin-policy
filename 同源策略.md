## 同源策略

协议 域名 端口 同域

## 为什么浏览器不支持跨域

cookie  LocalStorage

DOM 元素也有同源策略 iframe

ajax也不支持跨域

## 实现跨域

+ jsonp
+ cors
+ postMessage
+ Document.domain
+ Window.name
+ Location.hash
+ http-proxy
+ nginx
+ websocket

## JSONP

1. 本地声明一个函数

```javascript
function show(data){
  console.log(data)
}
```

2. 后段返回该函数的执行

```html
<script src="https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/su?wd=lol&cb=show"></script>
// cb就是厚度返回的执行函数名
```

```json
//后端会返回
show({p: false
			q: "lol"
			s: (10) ["lol官网", "lol手游", "lol转区", "lol是什么意思", "lol半价吧", "lol春季赛", "lol转区系统"])
```

### 封装一个通用jonsp函数

```javascript
//使用
jsonp({
  url:'xxx',
  params:{wd:'xxx'},
  cb:'xx'
}).then(res=>console.log(data))
```

 ```javascript
let jsonp = ({url,params,cb})=>{
  return new Promise((resolve,reject)=>{
     //1.创建一个script标签
    let script = document.createElement('script')
    //3. 将cb挂载到全局中，后端会返回cb(数据),接收数据返回数据即可
    window[cb]=function(data){
      resolve(data)
			//4. 记得将增加到script删除
      script.remove()
    }
    //2.将params和cb转化成wd=xxx&cb=xxx
    params = {...params,cb}
		let arr = []
    for(let key in params){
      arr.push(`${key}=${params[key]}`)
    }
    script.src=url+'?'+arr.join('&')
    document.body.appendChild(script)
  })
}
 ```





